<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Multiple projects in the same folder | SabotageAndi Blog</title>
    <meta name="description" content="Personal blog migrated from Hugo to Jekyll">
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <header>
      <h1><a href="/">SabotageAndi Blog</a></h1>
    </header>
    <main>
      <p>In SpecFlow+ we are supporting multiple different versions of SpecFlow (currently 1.9, 2.1 and 2.2) and so we have to test each version with the full set of our test suite.
As we donâ€™t want to copy a lot of code and then change some references/package version, I was looking if it is without much pain possible, that you have multiple projects/csprojs in one folder and produce so multiple assemblies.
We are already having a solution with the old project system, but it involves a lot of  linked files and manual editing of the project files. So with the new project system it was time to look at this again.</p>

<p>And after some work I had a solution to achieve this with the new csproj format. Here it is:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project&gt;</span>
    <span class="nt">&lt;PropertyGroup&gt;</span>
        <span class="nt">&lt;BaseIntermediateOutputPath&gt;</span>obj\$(MSBuildProjectName)<span class="nt">&lt;/BaseIntermediateOutputPath&gt;</span>
    <span class="nt">&lt;/PropertyGroup&gt;</span>
    
    <span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"Sdk.props"</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;PropertyGroup&gt;</span>
        <span class="nt">&lt;TargetFramework&gt;</span>netstandard2.0<span class="nt">&lt;/TargetFramework&gt;</span>
        <span class="nt">&lt;OutputPath&gt;</span>bin\$(Configuration)\$(TargetFramework)\$(MSBuildProjectName)<span class="nt">&lt;/OutputPath&gt;</span>
    <span class="nt">&lt;/PropertyGroup&gt;</span>

    <span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"Sdk.targets"</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;Compile</span> <span class="na">Remove=</span><span class="s">"obj\\**\*"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"obj\$(MSBuildProjectName)\**\$(MSBuildProjectName).AssemblyInfo.cs"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>
<span class="nt">&lt;/Project&gt;</span>
</code></pre></div></div>

<p>So what does it in detail?</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Project&gt;</span>
</code></pre></div></div>
<p>Yes, there is no Sdk attribute defined. How does this work?</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;BaseIntermediateOutputPath&gt;</span>obj\$(MSBuildProjectName)<span class="nt">&lt;/BaseIntermediateOutputPath&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span>
</code></pre></div></div>

<p>We are adjusting the BaseIntermediateOutputPath, so that each project has itâ€™s own and donâ€™t replace each others file. This is also the reason, why we have no Sdk attribute set. This property has to be set before the Sdk.props file is evaluated.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"Sdk.props"</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>So, finally import the first part of the Sdk.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;TargetFramework&gt;</span>netstandard2.0<span class="nt">&lt;/TargetFramework&gt;</span>
    <span class="nt">&lt;OutputPath&gt;</span>bin\$(Configuration)\$(TargetFramework)\$(MSBuildProjectName)<span class="nt">&lt;/OutputPath&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span>
</code></pre></div></div>

<p>The TargetFramework property is well known. Nothing to add about this here.
The OutputPath property is the location where the finished assemblies are copied. As BaseIntermediateOutputPath it has to be adjusted, so that each project has itâ€™s own folder.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Import</span> <span class="na">Project=</span><span class="s">"Sdk.targets"</span> <span class="na">Sdk=</span><span class="s">"Microsoft.NET.Sdk"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>And now the second and last part of the Sdk is imported.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ItemGroup&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Remove=</span><span class="s">"obj\\**\*"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Compile</span> <span class="na">Include=</span><span class="s">"obj\$(MSBuildProjectName)\**\$(MSBuildProjectName).AssemblyInfo.cs"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div></div>

<p>This is one of the stranges parts of the file. The reason for this is, that during build the version infos from the csproj are written to an *.AssemblyInfo.cs file in the obj folder. Combined with the globbing in the new format, MSBuild now finds multiple *.AssemblyInfo.cs files (one for each project).
So we have to remove the whole obj subtree from the compiler and readd the AssemblyInfo.cs for our project to get the version infos into the assembly.</p>

<p>Everything clear now? ðŸ˜‰
And the best, Visual Studio 2017 can handle this files without problems.</p>

<p>You can find a complete example with two projects here: <a href="https://github.com/SabotageAndi/MultipleProjecsInSameFolder">https://github.com/SabotageAndi/MultipleProjecsInSameFolder</a></p>

<p>Conclusion: I have to say, I am very happy with the new project system. Something like this wouldnâ€™t be possible with the old one (or it would be a lot more painful).
Letâ€™s see what nice hacks are also possible in the future.</p>

    </main>
    <footer>
      <p>&copy; 2025 SabotageAndi Blog</p>
    </footer>
  </body>
</html>
