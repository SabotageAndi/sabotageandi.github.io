<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Multiple projects in the same folder" />
<meta property="og:description" content="In SpecFlow&#43; we are supporting multiple different versions of SpecFlow (currently 1.9, 2.1 and 2.2) and so we have to test each version with the full set of our test suite. As we don&rsquo;t want to copy a lot of code and then change some references/package version, I was looking if it is without much pain possible, that you have multiple projects/csprojs in one folder and produce so multiple assemblies. We are already having a solution with the old project system, but it involves a lot of linked files and manual editing of the project files." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://willich.io/2017/10/12/multiple-projects-in-the-same-folder/" />
<meta property="article:published_time" content="2017-10-12T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2017-10-12T00:00:00&#43;00:00"/>

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Multiple projects in the same folder"/>
<meta name="twitter:description" content="In SpecFlow&#43; we are supporting multiple different versions of SpecFlow (currently 1.9, 2.1 and 2.2) and so we have to test each version with the full set of our test suite. As we don&rsquo;t want to copy a lot of code and then change some references/package version, I was looking if it is without much pain possible, that you have multiple projects/csprojs in one folder and produce so multiple assemblies. We are already having a solution with the old project system, but it involves a lot of linked files and manual editing of the project files."/>



    <link rel="canonical" href="https://willich.io/2017/10/12/multiple-projects-in-the-same-folder/">

    <title>
      
        Multiple projects in the same folder | Hi, I&#39;m Andreas
      
    </title>

    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://willich.io/css/style.css" rel="stylesheet">

    

    

    
  </head>
  <body>
    
      

<header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="/">
            Hi, I&#39;m Andreas
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">Home</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">About</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/blog/">Blog</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/speaking/">Speaking</a>
                    
                </li>
                
            </ul>
            
        </div>
    </nav>
</header>

    

    
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
        <a class="text-dark" href="/2017/10/12/multiple-projects-in-the-same-folder/">Multiple projects in the same folder</a>
    </h2>
    


<div class="blog-post-date text-secondary">
    
        Oct 12, 2017
    
</div>

    
    
    <hr>
</header>
<article class="blog-post">
    <p>In SpecFlow+ we are supporting multiple different versions of SpecFlow (currently 1.9, 2.1 and 2.2) and so we have to test each version with the full set of our test suite.
As we don&rsquo;t want to copy a lot of code and then change some references/package version, I was looking if it is without much pain possible, that you have multiple projects/csprojs in one folder and produce so multiple assemblies.
We are already having a solution with the old project system, but it involves a lot of  linked files and manual editing of the project files. So with the new project system it was time to look at this again.</p>

<p>And after some work I had a solution to achieve this with the new csproj format. Here it is:</p>

<pre><code class="language-xml">&lt;Project&gt;
    &lt;PropertyGroup&gt;
        &lt;BaseIntermediateOutputPath&gt;obj\$(MSBuildProjectName)&lt;/BaseIntermediateOutputPath&gt;
    &lt;/PropertyGroup&gt;
    
    &lt;Import Project=&quot;Sdk.props&quot; Sdk=&quot;Microsoft.NET.Sdk&quot;/&gt;

    &lt;PropertyGroup&gt;
        &lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt;
        &lt;OutputPath&gt;bin\$(Configuration)\$(TargetFramework)\$(MSBuildProjectName)&lt;/OutputPath&gt;
    &lt;/PropertyGroup&gt;

    &lt;Import Project=&quot;Sdk.targets&quot; Sdk=&quot;Microsoft.NET.Sdk&quot;/&gt;

    &lt;ItemGroup&gt;
        &lt;Compile Remove=&quot;obj\\**\*&quot;/&gt;
        &lt;Compile Include=&quot;obj\$(MSBuildProjectName)\**\$(MSBuildProjectName).AssemblyInfo.cs&quot;/&gt;
    &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>

<p>So what does it in detail?</p>

<pre><code class="language-xml">&lt;Project&gt;
</code></pre>

<p>Yes, there is no Sdk attribute defined. How does this work?</p>

<pre><code class="language-xml">&lt;PropertyGroup&gt;
    &lt;BaseIntermediateOutputPath&gt;obj\$(MSBuildProjectName)&lt;/BaseIntermediateOutputPath&gt;
&lt;/PropertyGroup&gt;
</code></pre>

<p>We are adjusting the BaseIntermediateOutputPath, so that each project has it&rsquo;s own and don&rsquo;t replace each others file. This is also the reason, why we have no Sdk attribute set. This property has to be set before the Sdk.props file is evaluated.</p>

<pre><code class="language-xml">&lt;Import Project=&quot;Sdk.props&quot; Sdk=&quot;Microsoft.NET.Sdk&quot;/&gt;
</code></pre>

<p>So, finally import the first part of the Sdk.</p>

<pre><code class="language-xml">&lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt;
    &lt;OutputPath&gt;bin\$(Configuration)\$(TargetFramework)\$(MSBuildProjectName)&lt;/OutputPath&gt;
&lt;/PropertyGroup&gt;
</code></pre>

<p>The TargetFramework property is well known. Nothing to add about this here.
The OutputPath property is the location where the finished assemblies are copied. As BaseIntermediateOutputPath it has to be adjusted, so that each project has it&rsquo;s own folder.</p>

<pre><code class="language-xml">&lt;Import Project=&quot;Sdk.targets&quot; Sdk=&quot;Microsoft.NET.Sdk&quot;/&gt;
</code></pre>

<p>And now the second and last part of the Sdk is imported.</p>

<pre><code class="language-xml">&lt;ItemGroup&gt;
    &lt;Compile Remove=&quot;obj\\**\*&quot;/&gt;
    &lt;Compile Include=&quot;obj\$(MSBuildProjectName)\**\$(MSBuildProjectName).AssemblyInfo.cs&quot;/&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>This is one of the stranges parts of the file. The reason for this is, that during build the version infos from the csproj are written to an *.AssemblyInfo.cs file in the obj folder. Combined with the globbing in the new format, MSBuild now finds multiple *.AssemblyInfo.cs files (one for each project).
So we have to remove the whole obj subtree from the compiler and readd the AssemblyInfo.cs for our project to get the version infos into the assembly.</p>

<p>Everything clear now? üòâ
And the best, Visual Studio 2017 can handle this files without problems.</p>

<p>You can find a complete example with two projects here: <a href="https://github.com/SabotageAndi/MultipleProjecsInSameFolder">https://github.com/SabotageAndi/MultipleProjecsInSameFolder</a></p>

<p>Conclusion: I have to say, I am very happy with the new project system. Something like this wouldn&rsquo;t be possible with the old one (or it would be a lot more painful).
Let&rsquo;s see what nice hacks are also possible in the future.</p>


    

    


    <br/>
    <br/>
    <br/>
    <br/>
    &nbsp;
</article>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
    
        <section>
    
        
    
        
    
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
      






<footer class="blog-footer w-100 fixed-bottom">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center">Disclaimer: The opinions expressed herein are my own personal opinions and do not represent my employer‚Äôs view in any way.</p>
        <p class="w-100 text-center">Hugo template made with ‚ù§ by <a href="https://github.com/Xzya">Xzya</a>, inspired by <a href="https://github.com/alanorth/hugo-theme-bootstrap4-blog">hugo-theme-bootstrap4-blog</a></p>
    </nav>
</footer>

    

    
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  </body>
</html>
